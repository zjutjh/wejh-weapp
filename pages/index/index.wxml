<!--index.wxml-->
<import src="../../components/app-list/app-list.wxml"></import>
<import src="../../components/tiny-tip/tiny-tip.wxml"></import>

<view class="container f-bg-gray f-pb-300 f-tri" style="background-image: url({{icons.tri.card}});">
  <template is="tiny-tip" data="{{ tinyTip, onClickApp }}" />

  <template is="app-list" data="{{ apps, userInfo }}" />

  <view class="m-help-box" wx:if="{{helpStatus}}">
    <view class="box">
      <view class="header">
        <text class="title">{{announcement.title}}</text>
        <image
          class="icon-close"
          src="/images/common/close.png"
          bindtap="hideHelp"
          mode="aspectFit"
        ></image>
      </view>
      <rich-text class="content announcement" type="text" nodes="{{announcement.content}}">
      </rich-text>
      <text class="footer announcement" selectable="true" wx:if="{{announcement.footer}}"
        >{{announcement.footer}}</text
      >
      <text
        class="clipboard announcement"
        selectable="true"
        bindtap="clipboard"
        wx:if="{{announcement.clipboard}}"
        >{{announcement.clipboard}}</text
      >
    </view>
  </view>

  <view wx:if="{{!userInfo}}" class="m-remind-box">
    <image class="remind-img" mode="aspectFit" src="/images/common/nothing.png"></image>
    <text class="remind-text">è¯·ç™»å½•</text>
    <navigator url="/pages/login/login" class="remind-btn">å‰å¾€ç»‘å®š</navigator>
  </view>

  <navigator
    url="/pages/timetable/timetable"
    wx:if="{{timetableToday}}"
    class="m-index-card f-mt-20"
    style="background-image: url({{icons.timetable.card}});"
  >
    <view class="header">
      <view class="image">
        <image class="icon" src="{{icons.timetable.icon}}" mode="aspectFit"></image>
        <image class="icon-bg" src="{{icons.timetable.bg}}" mode="aspectFit"></image>
      </view>
      <text class="title">ä»Šæ—¥è¯¾è¡¨{{cacheStatus.timetable ? ' (ç¦»çº¿æ¨¡å¼)' : ''}}</text>
    </view>
    <view class="content">
      <view class="timetable-card">
        <view
          class="timetable-item"
          wx:if="{{timetableToday.length}}"
          wx:for="{{timetableToday}}"
          wx:for-item="lesson"
          wx:for-index="index"
          wx:key="lesson_{{index}}"
        >
          <view class="main-info">
            <text class="name">{{lesson['è¯¾ç¨‹åç§°']}}</text>
            <text class="info"
              >{{lesson['èµ·æ­¢å‘¨'] ? lesson['èµ·æ­¢å‘¨'] + 'å‘¨ ' : ''}}{{lesson['èµ·æ­¢èŠ‚'] ?
              lesson['èµ·æ­¢èŠ‚'] + 'èŠ‚ ' : ''}}</text
            >
          </view>
          <view class="place">{{lesson['åœ°ç‚¹']}}</view>
        </view>
        <view class="timetable-nothing" wx:if="{{timetableToday.length === 0}}">
          <text>ä»Šå¤©å±…ç„¶æ²¡æœ‰è¯¾~ğŸ˜†</text>
        </view>
      </view>
    </view>
    <view class="bottom">æŸ¥çœ‹å…¨éƒ¨è¯¾è¡¨</view>
  </navigator>

  <navigator
    url="/pages/card/card"
    wx:if="{{card}}"
    class="m-index-card f-mt-20"
    style="background-image: url({{icons.card.card}});"
  >
    <view class="header">
      <view class="image">
        <image class="icon" src="{{icons.card.icon}}" mode="aspectFit"></image>
        <image class="icon-bg" src="{{icons.card.bg}}" mode="aspectFit"></image>
      </view>
      <text class="title">ä¸€å¡é€š</text>
    </view>
    <view class="content">
      <view class="card-card">
        <view class="header">
          <text class="label">ä½™é¢</text>
          <text class="date">æˆªæ­¢æ—¶é—´: {{todayTime}}</text>
        </view>
        <view class="balance">
          <text class="value">{{card['å¡ä½™é¢']}}</text>
          <text class="unit">å…ƒ</text>
        </view>
        <view class="today" wx:if="{{cardCost.cost.length > 0}}">
          <view class="label">ä»Šæ—¥æ¶ˆè´¹: </view>
          <view class="cost">
            <rich-text type="text" nodes="{{cardCost.text}}"></rich-text>
          </view>
        </view>
      </view>
    </view>
  </navigator>

  <navigator
    url="/pages/borrow/borrow"
    wx:if="{{borrow && borrow.borrow_list.length > 0}}"
    class="m-index-card f-mt-20"
    style="background-image: url({{icons.borrow.card}});"
  >
    <view class="header">
      <view class="image">
        <image class="icon" src="{{icons.borrow.icon}}" mode="aspectFit"></image>
        <image class="icon-bg" src="{{icons.borrow.bg}}" mode="aspectFit"></image>
      </view>
      <text class="title">å€Ÿé˜…ä¿¡æ¯</text>
    </view>
    <view class="content">
      <view class="borrow-card">
        <view class="header">
          <text class="label">å½“å‰å€Ÿé˜…: {{borrow.borrow_num}}</text>
          <text class="date">æ¬ è´¹é‡‘é¢: {{borrow.debt}}å…ƒ</text>
        </view>
        <view class="borrow-list">
          <view
            class="borrow-item"
            wx:for="{{borrow.borrow_list}}"
            wx:for-item="book"
            wx:for-index="index"
            wx:key="book_{{index}}"
          >
            <view class="book">
              <image class="icon-book" src="/images/index/borrow-book.png" mode="aspectFit"></image>
              <text class="title">{{book['ä¹¦å']}}</text>
            </view>
            <view class="borrow">
              <text class="date">{{book['å€Ÿä¹¦æ—¥æœŸ']}}</text>
              <text class="unit">å€Ÿ</text>
            </view>
            <view class="return{{book['è¶…æœŸå¤©æ•°'] > 0 ? ' red' : ''}}">
              <text class="date">{{book['åº”è¿˜æ—¥æœŸ']}}</text>
              <text class="unit">è¿˜</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </navigator>
</view>
